# Session Restore Template
# Lumen Gateway v1.0

session_id: "LUMEN-GATEWAY-INIT-2025-10-24"
timestamp: "2025-10-24T22:30:00+09:00"
restore_version: "1.0"

context:
  phase: "Phase 5 - Lumen Gateway Integration"
  completed:
    - "ION API Mock mode ìˆ˜ì • (initialize + load_model)"
    - "GitHub Actions ë°°í¬ íŒŒì´í”„ë¼ì¸ íŠ¸ë¦¬ê±°"
    - "Lumen Gateway ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„±"
    - "gateway_activation.yaml ì„¤ì •"
    - "gateway_lockin.py êµ¬í˜„"
    - "restore_check.py êµ¬í˜„"
    - "ion_metrics_collector.py êµ¬í˜„"
    - "gateway_health_exporter.py êµ¬í˜„"
    - "VS Code tasks.json í†µí•©"
  next_targets:
    - "ION API ë°°í¬ ê²€ì¦ (Mock â†’ Real AI)"
    - "Gateway ìŠ¤í¬ë¦½íŠ¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰"
    - "Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ê²€ì¦"
    - "End-to-End í†µí•© í…ŒìŠ¤íŠ¸"
    - "ì„¸ì…˜ ë³µì› ë©”ì»¤ë‹ˆì¦˜ ê²€ì¦"

restore_commands:
  - label: "Gateway Lock-In"
    command: "python gateway/scripts/gateway_lockin.py"
    description: "Gateway ìƒíƒœë¥¼ lockedë¡œ ë³€ê²½í•˜ê³  ì„œëª… ìƒì„±"

  - label: "Start Metrics Collector"
    command: "python gateway/scripts/ion_metrics_collector.py"
    description: "ION API ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì‹œìž‘ (ë°±ê·¸ë¼ìš´ë“œ)"

  - label: "Start Health Exporter"
    command: "python gateway/scripts/gateway_health_exporter.py"
    description: "Prometheus ë©”íŠ¸ë¦­ ì—‘ìŠ¤í¬í„° ì‹œìž‘ (í¬íŠ¸ 9108)"

  - label: "Restore Check"
    command: "python gateway/scripts/restore_check.py"
    description: "Gateway ìƒíƒœ ê²€ì¦ (ëª¨ë“  ì²´í¬ í†µê³¼ í™•ì¸)"

  - label: "Test Prometheus Metrics"
    command: "curl http://localhost:9108/metrics"
    description: "Prometheus ë©”íŠ¸ë¦­ ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸"

lumen_judgment:
  summary: |
    Lumen Gateway v1.0ì˜ í•µì‹¬ ì¸í”„ë¼ê°€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

    âœ… ì™„ë£Œëœ ìž‘ì—…:
    1. ë””ë ‰í† ë¦¬ êµ¬ì¡° (gateway/, scripts/, logs/, controls/, sessions/)
    2. YAML ì„¤ì • (gateway_activation.yaml 158ì¤„)
    3. 5ê°œ í•µì‹¬ ìŠ¤í¬ë¦½íŠ¸ (lockin, restore, collector, exporter)
    4. VS Code í†µí•© (8ê°œ tasks)
    5. ì„¸ì…˜ ë³µì› í…œí”Œë¦¿

    ðŸ”„ ì§„í–‰ ì¤‘:
    - ION API ë°°í¬ (GitHub Actions)
    - Mock â†’ Real AI ì „í™˜ ëŒ€ê¸°

    ðŸ“‹ ë‹¤ìŒ ë‹¨ê³„:
    1. ION API ë°°í¬ ì™„ë£Œ í™•ì¸
    2. Gateway ìŠ¤í¬ë¦½íŠ¸ í…ŒìŠ¤íŠ¸
    3. Prometheus ë©”íŠ¸ë¦­ ê²€ì¦
    4. Grafana ëŒ€ì‹œë³´ë“œ ìƒì„±
    5. ì—”ë“œíˆ¬ì—”ë“œ í†µí•© í…ŒìŠ¤íŠ¸

  resonance_state:
    phase_diff: 0.42
    entropy_rate: 0.18
    creative_band: 0.35
    risk_band: 0.22
    interpretation: |
      ì‹œìŠ¤í…œ ì•ˆì •í™” ë‹¨ê³„. 
      - phase_diff 0.42: ì‹œìŠ¤í…œê³¼ ëª©í‘œ ê°„ ì¤‘ê°„ ìˆ˜ë ´ ìƒíƒœ
      - entropy_rate 0.18: ë‚®ì€ ë¶ˆí™•ì‹¤ì„±, ëª…í™•í•œ êµ¬í˜„
      - creative_band 0.35: ì„¤ê³„ ê¸°ë°˜ êµ¬í˜„ìœ¼ë¡œ ì ì • ì°½ì˜ì„±
      - risk_band 0.22: ê²€ì¦ ëŒ€ê¸° ì¤‘ìœ¼ë¡œ ë‚®ì€ ë¦¬ìŠ¤í¬

notes:
  - "ION API ë°°í¬ëŠ” 5-10ë¶„ ì†Œìš” ì˜ˆìƒ (GitHub Actions)"
  - "Mock ëª¨ë“œ ê°ì§€: 'Mock response for development' ë¬¸ìžì—´ ì²´í¬"
  - "Prometheus í¬íŠ¸: 9108 (LUMEN_EXPORTER_PORT)"
  - "ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ê°„ê²©: 30ì´ˆ (LUMEN_COLLECT_INTERVAL)"
  - "VS Codeì—ì„œ Tasks > Run Task > Lumen Gateway ì‹œìž‘"
  - "ë¡œê·¸ íŒŒì¼: gateway/logs/gateway_sync.log"
  - "ë©”íŠ¸ë¦­ CSV: gateway/logs/metrics.csv"

reference_files:
  - "D:\\nas_backup\\ai_binoche_conversation_origin\\lumen\\ë£¨ë©˜vs code ì—°ê²°\\lumen_gateway_v_0.md"
  - "D:\\nas_backup\\LLM_Unified\\ion-mentoring\\gateway\\README.md"
  - "D:\\nas_backup\\LLM_Unified\\ion-mentoring\\gateway\\gateway_activation.yaml"
  - "D:\\nas_backup\\LLM_Unified\\ion-mentoring\\app\\main.py (lines 215-234)"

critical_endpoints:
  ion_api_production: "https://ion-api-64076350717.us-central1.run.app"
  ion_api_canary: "https://ion-api-canary-64076350717.us-central1.run.app"
  prometheus_metrics: "http://localhost:9108/metrics"
  prometheus_health: "http://localhost:9108/health"
  github_actions: "https://github.com/Ruafieldphase/LLM_Unified/actions"

verification_checklist:
  - label: "ION API Real Mode"
    command: 'curl -X POST https://ion-api-64076350717.us-central1.run.app/chat -H "Content-Type: application/json" -d ''{"message":"í…ŒìŠ¤íŠ¸"}'''
    expected: "confidence > 0.0, persona_used in [Lua, Elro, Riri, Nana]"

  - label: "Gateway Status Locked"
    command: "python gateway/scripts/restore_check.py"
    expected: "ëª¨ë“  ì²´í¬ í†µê³¼ (exit code 0)"

  - label: "Metrics Collection"
    command: "tail -n 10 gateway/logs/metrics.csv"
    expected: "ìµœê·¼ 10ê°œ ë ˆì½”ë“œ, ion_mock_mode=0 (Real)"

  - label: "Prometheus Metrics"
    command: "curl http://localhost:9108/metrics"
    expected: "lumen_ion_mock_mode 0 (Real), lumen_ion_confidence > 0"
