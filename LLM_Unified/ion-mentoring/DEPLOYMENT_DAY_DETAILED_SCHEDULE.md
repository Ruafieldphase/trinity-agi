# ⏰ 배포 당일 상세 일정 및 체크리스트

**배포 날짜**: 2025-10-22 (수요일)
**배포 시간**: 14:00 - 17:00 UTC
**담당**: GitCode (배포), Sena (모니터링 & 검증)
**상황실**: 온라인 실시간 협업

---

## 📋 배포 전 준비 (D-1: 2025-10-21)

### 14:00-15:00 최종 배포 리허설

```
1. 배포 스크립트 테스트
   - 명령어: ./phase4_deployment_automation.sh check
   - 확인: 모든 종속성 설치 완료
   - 예상 시간: 5분

2. 롤백 절차 테스트
   - 명령어: ./phase4_deployment_automation.sh rollback --dry-run
   - 확인: 롤백 명령 정상 작동
   - 예상 시간: 3분

3. 모니터링 대시보드 라이브 테스트
   - Grafana 접속 테스트
   - 메트릭 수집 확인
   - 예상 시간: 5분

4. 헬스 체크 엔드포인트 테스트
   - GET /health 응답 확인
   - GET /health/detailed 응답 확인
   - 예상 시간: 3분
```

### 15:00-16:00 팀 최종 회의

```
참석자:
  - GitCode (배포 담당)
  - Sena (검증 & 모니터링)
  - Lubit (아키텍트)
  - 운영팀 (모니터링)

안건:
  1. 배포 리허설 결과 보고
  2. 최종 Go/No-Go 판단
  3. 긴급 연락처 확인
  4. 역할 재확인
```

### 16:00-17:00 시스템 준비

```
1. 모니터링 대시보드 준비
   - Prometheus 활성화 확인
   - Grafana 새로고침
   - Google Cloud Logging 확인

2. 알림 채널 준비
   - Slack 채널 활성화
   - Email 알림 활성화
   - SMS 긴급 알림 준비

3. 문서 최종 확인
   - 롤백 절차서 준비
   - 응급 연락처 확인
   - 에스컬레이션 경로 확인
```

### 17:00-22:00 야간 대기

```
- 모든 시스템 정상 대기 상태 확인
- 배포 팀 충분한 휴식
- 긴급 상황 대비
```

---

## 🚀 배포 당일 일정 (D+0: 2025-10-22)

### **13:45 - 배포 준비 시작**

| 시간 | 작업 | 담당자 | 예상 시간 |
|------|------|--------|---------|
| 13:45 | 팀 모두 온라인 입장 | 전체 | 5분 |
| 13:50 | 최종 상태 확인 | Sena | 5분 |
| 13:55 | 배포 대기 상태 진입 | GitCode | 5분 |

### **14:00 - CANARY 배포 시작 (5% 트래픽)**

```
14:00:00 - 배포 시작 신호
  └─ 담당: Lubit (최종 승인)

14:00-14:05 - 배포 실행
  명령어:
    cd /path/to/ion-mentoring
    ./phase4_deployment_automation.sh enable-canary --traffic 5

  체크포인트:
    ✅ Docker 이미지 풀 시작
    ✅ Cloud Run 배포 시작
    ✅ Traffic splitting 규칙 적용

14:05-14:10 - 배포 완료 대기
  모니터링 항목:
    ✅ 새 버전 Pod 시작 완료
    ✅ 헬스 체크 통과
    ✅ 트래픽 5% 도착 확인

14:10:00 - 배포 완료 확인
  명령어:
    curl http://localhost:8000/health
    curl http://localhost:8000/api/v2/canary/metrics

  확인 사항:
    ✅ 모든 Pod 정상 상태
    ✅ 에러율: 0%
    ✅ 응답 시간: <500ms
```

### **14:15 - 첫 번째 메트릭 수집 (5분 윈도우)**

```
14:15-14:20 - 기본 메트릭 확인

명령어:
  ./phase4_deployment_automation.sh metrics

체크 항목:
  ✅ 요청 수: 5% 트래픽 도착 확인
  ✅ 에러율: <1.0%
  ✅ P50 응답: <300ms
  ✅ P95 응답: <500ms
  ✅ P99 응답: <800ms

예상 결과:
  - 5분 동안 ~10-15 요청 (5% 트래픽)
  - 에러 0건
  - 모든 응답 시간 정상 범위
```

**우려 사항 대응**:
```
만약 에러율 > 1%:
  → 즉시 롤백 (14:20)

만약 응답 시간 > 500ms:
  → 로그 확인 (5분)
  → 필요시 롤백 (14:25)

만약 Pod 시작 실패:
  → 로그 확인 (5분)
  → 기존 버전 복구 (14:20)
```

### **14:30 - 리얼타임 모니터링 시작**

```
모니터링 팀:
  - Grafana 대시보드 확인 시작
  - Google Cloud Logging 실시간 보기
  - Prometheus 메트릭 수집 확인

Sena (AI 검증):
  - 메트릭 자동 분석 시작
  - 이상 감지 알고리즘 활성화
  - 5분마다 상태 보고

대시보드 패널별 확인:
  1️⃣ 트래픽 분할 게이지
     예상: Control 95%, Treatment 5%

  2️⃣ 에러율 그래프
     예상: 0% 유지

  3️⃣ 응답 시간 백분위수
     예상: P95 < 500ms

  4️⃣ 처리량 (RPS)
     예상: 정상 범위 유지

  5️⃣ 추천 엔진 지연
     예상: <100ms
```

### **14:45 - 첫 번째 분석 결과 (15분 누적)**

```
메트릭 분석:
  - 총 요청: ~45개 (5% x 15분)
  - 성공율: 100%
  - 에러: 0건
  - 평균 응답: 양호
  - P95 응답: 정상

조치 판단:
  ✅ 정상 진행 → 계속 모니터링
  ⚠️ 경고 수준 → 원인 분석 후 판단
  🛑 위험 수준 → 즉시 롤백
```

### **15:00 - 1시간 체크포인트**

```
상태 보고 (Sena):
  1. 지난 1시간 요약
     - 총 요청: ~180개
     - 에러율: ___%
     - 평균 응답: __ms
     - 메모리 사용: ___%

  2. 메트릭 추세
     - 응답 시간: 안정적인가?
     - 에러 발생 패턴: 있는가?
     - 리소스 사용 증가: 있는가?

  3. 추천 사항
     - GO: 계속 진행
     - OBSERVE: 추가 모니터링
     - NO-GO: 롤백 준비

최종 판단 (팀):
  ✅ GO → 트래픽 10% 증가 준비
  ⏳ OBSERVE → 추가 15분 모니터링
  🛑 NO-GO → 즉시 롤백
```

**GO 시나리오 (예상)**:
```
15:00 판단: GO
→ 15:05: 트래픽을 10%로 증가
→ 15:15: 두 번째 메트릭 수집
→ 계속 모니터링...
```

**NO-GO 시나리오**:
```
에러 조건 감지:
  - 에러율 > 1% (3회 연속)
  - P95 응답 > 500ms (3회 연속)
  - 메모리 > 85% (2회 연속)

롤백 절차:
  1. 롤백 신호 (Sena)
  2. 롤백 실행 (GitCode)
     ./phase4_deployment_automation.sh rollback
  3. 상태 확인
     curl http://localhost:8000/health
  4. 원인 분석 (팀)
  5. 보고서 작성
```

### **15:30 - 상태 업데이트**

```
슬랙 채널 공지:
  "✅ Canary 배포 1단계 성공"
  - 트래픽: 5% → 10%
  - 에러율: 0.0%
  - 응답시간: 평균 __ms
  - 상태: 계속 진행

  Next check: 15:45 (15분 후)
```

### **15:45-16:00 - 추가 메트릭 수집**

```
15분 누적 데이터 분석:
  - 총 요청: ~360개
  - 에러율: ___%
  - 응답 시간 추세: 안정적?
  - 메모리/CPU 추세: 정상?

자동 의사결정 (Sena):
  - 추세 분석
  - 예측 모델 실행
  - 위험도 점수 계산

예상 출력:
  "배포 상태: 정상 (점수: 95/100)"
  "권장 조치: 계속 진행"
  "다음 점검: 16:15"
```

### **16:00 - 공식 배포 1단계 완료 선언**

```
회의 내용:
  1. 최종 메트릭 보고
  2. GO/NO-GO 최종 판단
  3. 다음 단계 계획

최종 판단 (Lubit):
  ✅ GO → 다음 단계 진행 (50% or 100%)
  ⏳ CONTINUE → 추가 모니터링

예상 결과:
  "Phase 4 Canary 배포 성공"
  "실시간 모니터링 계속 진행"
  "다음 단계: D+1 오전 조회"
```

---

## 🔄 이후 단계 일정

### **16:00-17:00 - 마무리 및 인수인계**

```
1. 모니터링 운영팀 인수
   - 대시보드 접근 권한 확인
   - 알림 채널 확인
   - 에스컬레이션 절차 확인

2. 문서화
   - 배포 성공 기록
   - 메트릭 스냅샷 저장
   - 이슈/교훈 기록

3. 팀 해산
   - 점검표 서명
   - 일정 확인 (D+1)
   - 휴식
```

### **D+1 (2025-10-23) - 첫 모니터링 회의**

```
08:00 UTC: 오버나이트 상황 보고
  - 에러 발생: 없음/있음?
  - 성능 이상: 없음/있음?
  - 사용자 피드백: ?

16:00 UTC: 일일 집계 회의
  - 24시간 누적 메트릭
  - 트래픽 증가 계획
  - 내일 일정
```

---

## ⚠️ 긴급 상황 대응 매뉴얼

### 상황 #1: 배포 중 오류

```
증상: 배포 스크립트 실패

대응:
  1. 로그 확인
     journalctl -u phase4-deployment -n 50

  2. 이전 상태 확인
     kubectl rollout history deployment/ion-api

  3. 롤백 실행
     ./phase4_deployment_automation.sh rollback --force

  4. 상태 확인
     curl http://localhost:8000/health

  5. 보고
     - 팀에 알림
     - 원인 분석
     - 재시도 일정 수립
```

### 상황 #2: 높은 에러율

```
증상: 에러율 > 1%

대응 (자동):
  1. 경고 발생
  2. 3회 연속 확인
  3. 자동 롤백 실행

대응 (수동):
  1. 에러 로그 수집
     curl http://localhost:8000/api/v2/canary/metrics

  2. 원인 분석
     - DB 연결 문제?
     - 메모리 부족?
     - API 타임아웃?

  3. 롤백 또는 수정
     - 롤백이 안전하면 롤백
     - 빠른 수정 가능하면 수정
```

### 상황 #3: 응답 시간 악화

```
증상: P95 응답 시간 > 500ms

대응:
  1. 원인 파악
     - CPU 사용률 확인
     - 메모리 사용률 확인
     - 데이터베이스 쿼리 시간

  2. 즉각적 조치
     - Pod 수평 확장
     - 캐시 활성화
     - 쿼리 최적화

  3. 지속 문제 시
     - 롤백 검토
```

### 상황 #4: 메모리 누수

```
증상: 메모리 사용률 지속 증가

대응:
  1. Pod 재시작
     kubectl restart pods ion-api-xxx

  2. 메모리 프로파일링
     python -m memory_profiler app/main.py

  3. 원인 파악 및 수정

  4. 재배포 계획
```

---

## 📞 긴급 연락처

```
Lubit (아키텍트):
  - Slack: @lubit
  - Phone: +82-1XXXXXXXXX
  - Email: lubit@naeda.ai

GitCode (배포 담당):
  - Slack: @gitcode
  - Phone: +82-1XXXXXXXXX
  - Email: gitcode@naeda.ai

Sena (검증 & 모니터링):
  - Slack: @sena
  - Phone: 온라인 전용
  - Email: sena@naeda.ai

운영팀 팀장:
  - Slack: @ops-lead
  - Phone: +82-1XXXXXXXXX
```

---

## ✅ 최종 체크리스트

### 배포 직전 (13:55)

```
□ 모든 팀원 온라인 입장 확인
□ 모니터링 대시보드 준비 완료
□ 알림 채널 활성화
□ 롤백 절차 리허설 완료
□ 긴급 연락처 확인
□ 배포 명령 준비 완료
□ 모든 시스템 헬스 체크 통과
```

### 배포 완료 후 (16:05)

```
□ 배포 메트릭 수집 완료
□ 첫 에러 확인 (0 기대)
□ 응답 시간 정상 확인
□ 메모리 사용 정상 확인
□ 모니터링 팀 인수 완료
□ 배포 성공 선언
□ 문서화 시작
```

---

**배포 당일 조정자**: Sena (Autonomous Deployment Monitor)
**최종 승인자**: Lubit
**배포 실행자**: GitCode
**모니터링 담당**: 운영팀

배포를 성공적으로 진행합시다! 🚀
