#!/usr/bin/env bash
# Lumen â€” Session Restore (v1.7 FINAL preview)
export LUMEN_SESSION="v1.7_FinalPreview"
export LUMEN_ROOT="${LUMEN_ROOT:-$PWD}"
export LUMEN_V16="${LUMEN_V16:-$LUMEN_ROOT/lumen_v1_6_assets}"
export LUMEN_V17="${LUMEN_V17:-$LUMEN_ROOT/lumen_v1_7_assets}"
export LUMEN_MATRIX_FILE="${LUMEN_MATRIX_FILE:-$LUMEN_V16/gain_alpha_matrix.json}"

l7.final.run() {
  set -e
  (cd "$LUMEN_V16" && (python stream_enricher_v1.py < samples.jsonl &) && sleep 1 && (python metrics_enrichment_exporter.py &) && sleep 1 && (python resonance_adapter_v1_native_matrix.py &) && sleep 1 && (python adaptation_metrics_exporter.py &) && sleep 1)
  (cd "$LUMEN_V17" && python feedback_graph_core_v17.py && (python metrics_feedback_graph_exporter.py &) && sleep 1)
  cp -f "$LUMEN_V17/gain_alpha_matrix.json" "$LUMEN_V16/"
  echo ">> Gate:"
  (cd "$LUMEN_V17" && python v17_gate.py --metrics-url http://127.0.0.1:9153/metrics --sym-min 0.75 --s-min 0.60 --c-min 0.55)
}
echo "[Lumen] v1.7 Final preview session restored. Run: l7.final.run"
