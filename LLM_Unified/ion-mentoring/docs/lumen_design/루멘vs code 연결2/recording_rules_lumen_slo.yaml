groups:
  - name: lumen-sli-slo
    interval: 30s
    rules:
      # SLI: maturity pass state as 1/0 series
      - record: sli:lumen_maturity_pass:raw
        expr: clamp_max(clamp_min(lumen_maturity_state, 0), 1)

      # Windowed pass ratio (last 5m/30m/24h)
      - record: sli:lumen_maturity_pass_ratio:5m
        expr: avg_over_time(sli:lumen_maturity_pass:raw[5m])
      - record: sli:lumen_maturity_pass_ratio:30m
        expr: avg_over_time(sli:lumen_maturity_pass:raw[30m])
      - record: sli:lumen_maturity_pass_ratio:24h
        expr: avg_over_time(sli:lumen_maturity_pass:raw[24h])

      # Error rate (1 - pass ratio)
      - record: err:lumen_maturity_error_ratio:5m
        expr: 1 - sli:lumen_maturity_pass_ratio:5m
      - record: err:lumen_maturity_error_ratio:30m
        expr: 1 - sli:lumen_maturity_pass_ratio:30m
      - record: err:lumen_maturity_error_ratio:24h
        expr: 1 - sli:lumen_maturity_pass_ratio:24h

      # Target & error budget (example: SLO 99.5% monthly ~0.5% budget)
      - record: slo:lumen_target
        expr: 0.995
      - record: slo:lumen_error_budget
        expr: 1 - slo:lumen_target
