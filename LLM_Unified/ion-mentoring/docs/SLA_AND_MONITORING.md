# SLA 정의 및 모니터링

## 📋 Service Level Agreement (SLA) 개요

**목표**: ION Mentoring API의 신뢰성 및 성능 보장
**범위**: 프로덕션 환경 (production)
**유효 기간**: 2024년 1월 ~ 2024년 12월

---

## 🎯 SLA 메트릭

### 1. 가용성 (Availability)

**목표**: 99.9% (월 45분 이하 다운타임)

```
계산: 정상 작동 시간 / 전체 시간 × 100

목표 달성:
- 월간: 99.9% 이상
- 분기: 99.9% 이상
- 연간: 99.9% 이상

거기 제외:
- 예정된 유지보수 (월 2회, 각 30분)
- 고객 오류로 인한 다운타임
- 타사 서비스 중단
```

### 2. 응답 시간 (Response Time)

**목표**:
- P50: < 500ms (중앙값)
- P95: < 2s (95 백분위수)
- P99: < 5s (99 백분위수)

```
측정 방법:
- CloudRun 메트릭 사용
- 모든 엔드포인트 포함
- 매일 집계

페널티:
- P95 > 5s: 신용 5%
- P99 > 10s: 신용 10%
```

### 3. 에러율 (Error Rate)

**목표**: < 0.1% (1,000개 요청당 1개 미만)

```
정의:
- 5xx 에러율
- 4xx 유효성 검사 에러 제외
- 레이트 제한 (429) 제외

페널티:
- 0.1% - 0.5%: 신용 5%
- 0.5% - 1%: 신용 10%
- > 1%: 신용 25%
```

### 4. 처리량 (Throughput)

**목표**: 1,000 req/s 이상

```
측정:
- 초당 요청 수
- 피크 시간 기준

확장 정책:
- 자동 스케일 1-100 인스턴스
- 로드 기반 확장
```

---

## 📊 모니터링 대시보드

### 실시간 모니터링 (Grafana)

```
Dashboard: ION API - SLA Monitoring

Panels:
1. Uptime (%)
   - 목표: 99.9%
   - 경고: < 99%

2. Response Time (P95)
   - 목표: < 2s
   - 경고: > 3s
   - 심각: > 5s

3. Error Rate (%)
   - 목표: < 0.1%
   - 경고: > 0.5%
   - 심각: > 1%

4. Throughput (req/s)
   - 목표: > 1,000
   - 경고: < 500

5. Database Health
   - Connection pool
   - Query latency
   - Disk usage
```

### 주간 리포트

```
자동 생성: 매주 월요일 9시

포함 내용:
- SLA 달성도 (%)
- 주요 지표 요약
- 사건 분석
- 개선 조치
- 예측
```

---

## 🎯 목표 달성도 추적

### 월별 집계

```sql
SELECT
  DATE_TRUNC(timestamp, MONTH) as month,
  100 * COUNT(CASE WHEN status != 'ERROR' THEN 1 END) / COUNT(*) as uptime_pct,
  APPROX_QUANTILES(latency_ms, 100)[OFFSET(50)] as p50,
  APPROX_QUANTILES(latency_ms, 100)[OFFSET(95)] as p95,
  APPROX_QUANTILES(latency_ms, 100)[OFFSET(99)] as p99,
  100 * SUM(CASE WHEN status >= 500 THEN 1 ELSE 0 END) / COUNT(*) as error_rate
FROM metrics
WHERE DATE(timestamp) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)
GROUP BY month
ORDER BY month DESC
```

### 분기별 보고

```
Q1 2024 Summary:
- 가용성: 99.95% ✅ (목표: 99.9%)
- P95: 1.8s ✅ (목표: 2s)
- P99: 4.2s ✅ (목표: 5s)
- 에러율: 0.02% ✅ (목표: 0.1%)
- 처리량: 1,200 req/s ✅ (목표: 1,000)

분기 등급: A (모든 목표 달성)
```

---

## 💳 신용 정책 (Service Credits)

### 신용 계산

```
Credit = Monthly Fee × Credit %

예시:
- 월 이용료: $1,000
- P95 > 5s for 1 hour: 5% = $50 환불
- 가용성 < 99%: 25% = $250 환불
```

### 신용 요청 절차

```
1. 고객이 신용 요청 (SLA 위반 후 30일 이내)
2. 우리가 검증 (BigQuery 로그 확인)
3. 신용 계산
4. 다음 인보이스에 반영 또는 환불
```

---

## 🚨 SLA 위반 대응

### 심각도별 대응

```
Level 1: P95 > 5s (1시간 이상)
├─ 즉시: 경고 알림 발송
├─ 10분: 조사 시작
├─ 30분: 대응 팀 집결
└─ 1시간: 복구 또는 롤백

Level 2: 가용성 < 99.5%
├─ 즉시: 심각 알림 발송
├─ 5분: 조사 시작
├─ 15분: 대응 팀 집결
└─ 30분: 복구 시작

Level 3: 에러율 > 1%
├─ 즉시: 심각 알림 발송
├─ 2분: 조사 시작
├─ 10분: 대응 팀 집결
└─ 15분: 복구 또는 롤백
```

### 사후 조치

```
1. 근본 원인 분석 (RCA)
   - 무엇이 실패했는가?
   - 왜 발생했는가?
   - 이전에 감지되지 않은 이유?

2. 예방 조치
   - 알림 규칙 개선
   - 모니터링 강화
   - 테스트 추가

3. 타임라인 공개
   - 고객에게 상황 공유
   - 개선 계획 제시
   - 신용 제공
```

---

## 📈 성능 벤치마크

### 현재 성능 (2024 Q1)

```
메트릭           | 목표      | 실제      | 달성도
─────────────────┼──────────┼──────────┼────────
가용성           | 99.9%    | 99.95%   | ✅
P50 응답시간     | < 500ms  | 320ms    | ✅
P95 응답시간     | < 2s     | 1.8s     | ✅
P99 응답시간     | < 5s     | 4.2s     | ✅
에러율           | < 0.1%   | 0.02%    | ✅
처리량           | 1,000    | 1,200    | ✅
```

### 트렌드 분석

```
지난 3개월 추세:
- 가용성: 상향 (99.85% → 99.95%)
- P95: 하향 (2.2s → 1.8s) ✅
- 에러율: 감소 (0.05% → 0.02%) ✅
- 처리량: 증가 (800 → 1,200) ✅

전망:
- 계속 개선 추세
- 모든 SLA 달성 가능
```

---

## 🔄 정기 검토

### 주간 검토 (매주 월요일)

```
Checklist:
- [ ] 지난주 SLA 달성도 확인
- [ ] 알림 규칙 검증
- [ ] 임계값 조정 필요 확인
- [ ] 팀 회의에서 결과 공유
```

### 월간 검토 (매월 1일)

```
- 월별 보고서 생성
- 고객에게 공유
- 개선 계획 수립
- 신용 계산 및 처리
```

### 분기별 검토 (매분기 1일)

```
- 분기별 종합 보고서
- SLA 목표 재평가
- 기술 개선 계획 수립
- 경영진 보고
```

---

## 🛠️ 도구 및 자동화

### 모니터링 스택

```
Google Cloud Monitoring
├─ 메트릭 수집
├─ 알림 규칙
└─ 대시보드

BigQuery
├─ 로그 분석
├─ 추세 분석
└─ 보고서 생성

Grafana
├─ 시각화
├─ 커스텀 쿼리
└─ 실시간 모니터링

PagerDuty
├─ 알림 관리
├─ 에스컬레이션
└─ 온콜 로테이션
```

### 자동화 작업

```bash
# 주간 SLA 리포트 자동 생성
0 9 * * MON  /scripts/generate_sla_report.sh

# 월간 신용 계산
0 9 1 * *    /scripts/calculate_credits.sh

# 분기별 보고서
0 9 1 1,4,7,10 * /scripts/quarterly_review.sh
```

---

## 📞 고객 지원

### SLA 관련 문의

```
이메일: sla@ion-mentoring.com
전화: 1-888-ION-4SLA
채팅: https://support.ion-mentoring.com/chat

대응 시간:
- 영업시간 (평일 9-18시): 1시간 이내
- 긴급 (P1): 15분 이내
- 기타: 24시간 이내
```

### 신용 요청

```
신청 방법:
1. 포털에서 신청: https://portal.ion-mentoring.com/credits
2. 이메일: sla@ion-mentoring.com
3. 전화: 1-888-ION-4SLA

필요 정보:
- SLA 위반 시간대
- 영향받은 기능
- 스크린샷/로그
- 예상 영향도
```

---

## 📅 개선 로드맵

### 2024년 목표

```
Q1: 현재 99.9% 달성
Q2: 99.95% 목표 (다중 지역)
Q3: 99.99% 도입 (고급 고객)
Q4: 99.99% 전체 확대
```

### 예상 개선 사항

```
- 다중 지역 배포 (Multi-region)
- 실시간 장애 조치 (Automatic failover)
- 고급 모니터링 (Distributed tracing)
- 성능 최적화 (CDN, 캐싱)
```

---

## ✅ SLA 체크리스트

### 배포 전

- [ ] SLA 메트릭 정의
- [ ] 모니터링 설정
- [ ] 알림 규칙 구성
- [ ] 고객에게 공시
- [ ] 신용 정책 수립

### 배포 후

- [ ] 일일 모니터링
- [ ] 주간 리포트
- [ ] 월간 검토
- [ ] 분기별 보고
- [ ] 연간 회고

---

**SLA는 고객 신뢰의 기초입니다. 함께 만들어갑시다! 🚀**
