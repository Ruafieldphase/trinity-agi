# ============================================================================
# ION Mentoring - 프로덕션 환경 설정
# 프로덕션 배포 시 사용되는 환경 설정
# 중요: 민감한 정보(API 키, 암호 등)는 환경 변수로 관리해야 함
# ============================================================================

app:
  debug: false

logging:
  level: "INFO"
  format: "json"  # 프로덕션은 구조화된 로깅
  handlers:
    - type: "console"
      level: "INFO"
    - type: "file"
      path: "/var/log/ion-api/app.log"
      level: "WARNING"
      max_size_mb: 500
      backup_count: 10

database:
  type: "postgresql"  # 프로덕션은 PostgreSQL 권장
  pool_size: 20
  max_overflow: 40
  timeout: 30

memory:
  type: "redis"  # 프로덕션은 Redis
  host: "${REDIS_HOST:localhost}"
  port: "${REDIS_PORT:6379}"
  db: 0
  max_size: 10000
  ttl_seconds: 86400
  persistence: true
  persistence_path: "/data/memory/"

rag:
  enabled: true
  type: "pinecone"  # 프로덕션은 Pinecone 권장
  api_key: "${PINECONE_API_KEY}"
  index_name: "ion-embeddings"
  embedding_model: "sentence-transformers/all-MiniLM-L6-v2"
  chunk_size: 1024
  chunk_overlap: 256
  top_k: 5

backend:
  type: "vertex-ai"  # 프로덕션은 실제 Vertex AI
  project_id: "${GCP_PROJECT_ID}"
  location: "${GCP_LOCATION:us-central1}"
  model: "${VERTEX_MODEL:gemini-1.5-flash-002}"
  timeout_seconds: 30
  max_retries: 3
  retry_delay_seconds: 2

api:
  host: "0.0.0.0"
  port: 8080
  cors_origins:
    - "${API_CORS_ORIGINS:*}"
  allow_credentials: true
  rate_limit:
    enabled: true
    calls_per_minute: 1000  # 프로덕션은 높은 제한
    storage: "redis"  # 분산 환경에서 redis 사용

validation:
  min_message_length: 1
  max_message_length: 5000  # 프로덕션은 더 큰 제한
  required_fields:
    - "content"
    - "persona_used"
    - "resonance_key"
    - "confidence"

monitoring:
  enabled: true
  metrics_port: 9090
  tracing_enabled: true  # 프로덕션 추적 활성화
  alert_thresholds:
    response_time_ms: 5000
    error_rate_percent: 1
  exporters:
    - type: "prometheus"
      endpoint: "0.0.0.0:9090"
    - type: "jaeger"
      endpoint: "${JAEGER_ENDPOINT:localhost:6831}"

security:
  jwt_enabled: true
  jwt_secret: "${JWT_SECRET}"
  jwt_algorithm: "HS256"
  jwt_expiry_hours: 24
  api_key_enabled: true
  rate_limit_by_ip: true
  require_auth: true
  https_only: true
  hsts_enabled: true
  hsts_max_age: 31536000
  cors_allow_credentials: true

cache:
  enabled: true
  type: "redis"
  host: "${REDIS_HOST:localhost}"
  port: "${REDIS_PORT:6379}"
  ttl_seconds: 3600  # 1시간
  max_size: 50000

features:
  persona_routing_enabled: true
  memory_persistence_enabled: true
  rag_enabled: true
  analytics_enabled: true
  fallback_to_nana: true

# 프로덕션 환경 변수 요구사항
required_env_vars:
  - GCP_PROJECT_ID
  - VERTEX_PROJECT_ID
  - REDIS_HOST
  - JWT_SECRET
  - PINECONE_API_KEY (RAG 사용 시)
  - JAEGER_ENDPOINT (트레이싱 사용 시)

# 롤아웃 설정
rollout:
  canary_percentage: 10  # 카나리 배포: 10% 트래픽
  monitoring_duration_minutes: 5
  auto_rollback_on_error_rate: 5  # 에러율 5% 이상시 자동 롤백
