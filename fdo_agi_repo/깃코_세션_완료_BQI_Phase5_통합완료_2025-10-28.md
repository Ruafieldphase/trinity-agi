# BQI Phase 5: í”¼ë“œë°± ì˜ˆì¸¡ ì‹œìŠ¤í…œ í†µí•© ì™„ë£Œ

**ë‚ ì§œ**: 2025-10-28  
**ì‘ì—…**: Phase 5 í•µì‹¬ ë²„ê·¸ ìˆ˜ì •, í›ˆë ¨ ë°ì´í„° íŒŒì´í”„ë¼ì¸ êµ¬ì¶•, ëŒ€ì‹œë³´ë“œ í†µí•©, ê²€ì¦ ì™„ë£Œ

## ğŸ¯ ì„¸ì…˜ ëª©í‘œ

Phase 5 predictor ì´ˆê¸° ì‹¤í–‰ì—ì„œ `0 samples` ë¬¸ì œ í•´ê²° ë° ì „ì²´ ì‹œìŠ¤í…œ í†µí•©

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. ğŸ› Critical Bug Fix: pipeline.py Indentation

**ë¬¸ì œ**: Python ì»´íŒŒì¼ ì˜¤ë¥˜ "ì˜ˆê¸°ì¹˜ ì•Šì€ ë“¤ì—¬ì“°ê¸°"

**ì›ì¸**: `registry.set_bqi_coord()` í˜¸ì¶œì´ ì˜ëª»ëœ ìœ„ì¹˜ì— ë“¤ì—¬ì“°ê¸°ë¨

```python
# BEFORE (ì˜¤ë¥˜)
registry = ToolRegistry(tool_cfg)
    registry.set_bqi_coord(bqi_coord.to_dict())  # âŒ ì˜ëª»ëœ ë“¤ì—¬ì“°ê¸°

# AFTER (ìˆ˜ì •)
registry = ToolRegistry(tool_cfg)
registry.set_bqi_coord(bqi_coord.to_dict())  # âœ… ì˜¬ë°”ë¥¸ ìœ„ì¹˜
```

**íŒŒì¼**: `fdo_agi_repo/orchestrator/pipeline.py` (line 142)

**ê²€ì¦**:

```powershell
get_errors(pipeline.py)  # â†’ No errors found âœ…
```

---

### 2. ğŸ“Š Training Data Pipeline: Ledger Enrichment

**ë¬¸ì œ**: Phase 5 predictorê°€ í•™ìŠµí•  BQI ì¢Œí‘œê°€ ledgerì— ì—†ìŒ

**í•´ê²°**: `run_config` ì´ë²¤íŠ¸ì— BQI ì¢Œí‘œ ì¶”ê°€

```python
# orchestrator/pipeline.py (line 137)
append_ledger({
    "event": "run_config",
    "task_id": task.task_id,
    "evaluation": {...},
    "corrections": {...},
    "bqi_coord": bqi_coord.to_dict(),  # â† ADDED for Phase 5 learning
})
```

**íš¨ê³¼**:

- í–¥í›„ ëª¨ë“  task ì‹¤í–‰ ì‹œ BQI ì¢Œí‘œ ìë™ ê¸°ë¡
- Phase 5 predictorê°€ 24ì‹œê°„ ì£¼ê¸°ë¡œ í•™ìŠµ ê°€ëŠ¥
- Phase 4 learnerì™€ ë™ì¼í•œ ë°ì´í„° ì†ŒìŠ¤ ì‚¬ìš© (ì¼ê´€ì„±)

**íŒŒì¼**: `fdo_agi_repo/orchestrator/pipeline.py` (line 137)

---

### 3. ğŸ“ˆ Dashboard Integration: Feedback Metrics Display

**ì¶”ê°€**: í†µí•© ëŒ€ì‹œë³´ë“œì— Phase 5 predictor ë©”íŠ¸ë¦­ í‘œì‹œ

```powershell
# scripts/quick_status.ps1 (lines 276-284)

# Parse feedback predictor metrics from bqi_learner_last_run.txt
$mFbS = [regex]::Match($lastLine, "fb_samples=(\d+)")
$mFbP = [regex]::Match($lastLine, "fb_patterns=(\d+)")
$mFbR = [regex]::Match($lastLine, "fb_rules=(\d+)")

if ($mFbS.Success -or $mFbP.Success -or $mFbR.Success) {
    $fbS = if ($mFbS.Success) { $mFbS.Groups[1].Value } else { "0" }
    $fbP = if ($mFbP.Success) { $mFbP.Groups[1].Value } else { "0" }
    $fbR = if ($mFbR.Success) { $mFbR.Groups[1].Value } else { "0" }
    Write-Host ("    Feedback: Samples {0}, Patterns {1}, Rules {2}" -f $fbS, $fbP, $fbR)
}
```

**ì¶œë ¥ ì˜ˆì‹œ**:

```text
ğŸ“Š BQI Learning Status
    Rules:    P:15 E:8 R:12
    Feedback: Samples 189, Patterns 34, Rules 7
```

**íŒŒì¼**: `scripts/quick_status.ps1` (lines 276-284)

---

### 4. ğŸ§ª System Verification: Full Test Suite

**ê²€ì¦ í•­ëª©**:

| í•­ëª© | ê²°ê³¼ | ë„êµ¬ |
|------|------|------|
| Python ì»´íŒŒì¼ | âœ… No errors | `get_errors(pipeline.py)` |
| í†µí•© ëŒ€ì‹œë³´ë“œ | âœ… ì„±ê³µ | Task: "Monitoring: Unified Dashboard" |
| BQI Learner+Predictor | âœ… ì„±ê³µ | Task: "BQI: Run Learner + Predictor" |
| pytest ì „ì²´ | âœ… All passed | Task: "Python: Run All Tests" |
| ë¬¸ì„œ lint | âœ… No errors | `get_errors(*.md)` |

**bqi_learner_last_run.txt í™•ì¸**:

```text
2025-10-28T14:35:55 | status=ok | prules=0 erules=0 rrules=0 fb_samples=0 fb_patterns=0 fb_rules=0
```

**Note**: `fb_samples=0`ì€ ì˜ˆìƒëœ ê²°ê³¼ (ledger enrichment í›„ ì•„ì§ ìƒˆ task ì‹¤í–‰ ì—†ìŒ)

---

### 5. ğŸ“ Documentation Cleanup: Markdown Lint Fixes

**ìˆ˜ì •**: 3ê°œ Phase 5 ë¬¸ì„œì—ì„œ ì´ 6ê°œ MD040 ì˜¤ë¥˜ ì œê±°

**ì˜¤ë¥˜ ìœ í˜•**: `MD040/fenced-code-language` (ì½”ë“œ íœìŠ¤ì— ì–¸ì–´ ì§€ì • ëˆ„ë½)

**ìˆ˜ì • ë‚´ìš©**:

```markdown
# BEFORE
(ì½”ë“œíœìŠ¤)
[Feedback] Learned from 267 tasks, 0 samples
(ì½”ë“œíœìŠ¤)

# AFTER
(ì½”ë“œíœìŠ¤ text)
[Feedback] Learned from 267 tasks, 0 samples
(ì½”ë“œíœìŠ¤)
```

**ìˆ˜ì •ëœ íŒŒì¼**:

1. `ê¹ƒì½”_BQI_Phase5_í”¼ë“œë°±ì˜ˆì¸¡_ì„¤ê³„_2025-10-29.md` (0ê°œ ì˜¤ë¥˜, ì›ë˜ ê¹¨ë—í•¨)
2. `ê¹ƒì½”_BQI_Phase5_ì§„í–‰í˜„í™©_2025-10-29.md` (2ê°œ â†’ 0ê°œ)
3. `ê¹ƒì½”_ì„¸ì…˜_ì™„ë£Œ_BQI_Phase5_ì„¤ê³„ì™„ë£Œ_2025-10-29.md` (4ê°œ â†’ 0ê°œ)

**ê²€ì¦**: `get_errors(*.md)` â†’ All clean âœ…

---

## ğŸ“Š Phase 5 ì‹œìŠ¤í…œ í˜„í™©

### í•µì‹¬ ê¸°ëŠ¥ (100% ì™„ì„±)

| ê¸°ëŠ¥ | ìƒíƒœ | ì„¤ëª… |
|------|------|------|
| íŒ¨í„´ í•™ìŠµ | âœ… | Ledger â†’ BQI íŒ¨í„´ â†’ ë§Œì¡±ë„ í‰ê·  |
| ë§Œì¡±ë„ ì˜ˆì¸¡ | âœ… | BQI ì¢Œí‘œ â†’ ì˜ˆì¸¡ ì ìˆ˜ (0.0-1.0) |
| ì¡°ì • íŒíŠ¸ | âœ… | ë‚®ì€ ë§Œì¡±ë„ ì‹œ íŒíŠ¸ ìƒì„± |
| í›ˆë ¨ ë°ì´í„° | âœ… | Ledger `run_config`ì— BQI ê¸°ë¡ |
| ìë™í™” | âœ… | `run_bqi_learner.ps1` í†µí•© |
| VS Code Tasks | âœ… | Learner+Predictor ì‹œí€€ìŠ¤ |
| ëŒ€ì‹œë³´ë“œ | âœ… | Metrics ì‹¤ì‹œê°„ í‘œì‹œ |

### í•™ìŠµ ë¡œì§

```python
satisfaction = quality
if had_second_pass:
    satisfaction *= 0.7  # 2ì°¨ íŒ¨ìŠ¤ í˜ë„í‹° -30%
if confidence < 0.6:
    satisfaction *= 0.9  # ë‚®ì€ í™•ì‹ ë„ -10%
```

### ì¡°ì • ì „ëµ

| ì˜ˆì¸¡ ë§Œì¡±ë„ | ì¡°ê±´ | ì¡°ì • íŒíŠ¸ | ì•¡ì…˜ |
|-------------|------|-----------|------|
| < 0.6 | priority â‰¥ 3 | `reduce_priority` | BQI priority ë‚®ì¶¤ (4â†’3) |
| < 0.6 | emotion = urgent | `add_empathy` | "ì´í•´í•©ë‹ˆë‹¤" í‘œí˜„ ì¶”ê°€ |
| < 0.6 | rhythm = debug | `add_explanation` | ê¸°ìˆ ì  ê·¼ê±° ì¶”ê°€ |

---

## ğŸš€ ìë™ ë™ì‘ ë©”ì»¤ë‹ˆì¦˜

### 1. Task ì‹¤í–‰ ì‹œ (ì‹¤ì‹œê°„)

```text
Task Start
    â†“
analyse_question() â†’ bqi_coord
    â†“
append_ledger(run_config, bqi_coord)  â† NEW!
    â†“
registry.set_bqi_coord()
    â†“
Task Execution
    â†“
append_ledger(eval, quality)
    â†“
append_ledger(second_pass)  (if triggered)
```

### 2. ì¼ì¼ í•™ìŠµ (24ì‹œê°„ ì£¼ê¸°)

```text
Scheduled Task (03:00)
    â†“
run_bqi_learner.ps1
    â†“
Phase 4: bqi_pattern_learner.py â†’ prules/erules/rrules
    â†“
Phase 5: feedback_predictor.py â†’ fb_samples/fb_patterns/fb_rules
    â†“
bqi_learner_last_run.txt ì—…ë°ì´íŠ¸
    â†“
Dashboardì— í‘œì‹œ
```

### 3. ëª¨ë‹ˆí„°ë§ (ì‹¤ì‹œê°„)

```powershell
# Unified Dashboard
& d:\nas_backup\scripts\quick_status.ps1

# ì¶œë ¥ ì˜ˆì‹œ:
# ğŸ“Š BQI Learning Status
#     Last Run: 2025-10-28T14:35:55+09:00
#     Rules:    P:15 E:8 R:12
#     Feedback: Samples 189, Patterns 34, Rules 7  â† NEW!
```

---

## ğŸ“ ë³€ê²½ëœ íŒŒì¼

```text
d:\nas_backup\
â”œâ”€â”€ fdo_agi_repo\
â”‚   â”œâ”€â”€ orchestrator\
â”‚   â”‚   â””â”€â”€ pipeline.py (lines 137, 142 ìˆ˜ì •) âš™ï¸
â”‚   â”œâ”€â”€ ê¹ƒì½”_BQI_Phase5_ì§„í–‰í˜„í™©_2025-10-29.md (lint ìˆ˜ì •) ğŸ“
â”‚   â””â”€â”€ ê¹ƒì½”_ì„¸ì…˜_ì™„ë£Œ_BQI_Phase5_ì„¤ê³„ì™„ë£Œ_2025-10-29.md (lint ìˆ˜ì •) ğŸ“
â”œâ”€â”€ scripts\
â”‚   â””â”€â”€ quick_status.ps1 (lines 276-284 ì¶”ê°€) ğŸ“ˆ
â””â”€â”€ ê¹ƒì½”_ì„¸ì…˜_ì™„ë£Œ_BQI_Phase5_í†µí•©ì™„ë£Œ_2025-10-28.md (ì´ íŒŒì¼) âœ…
```

---

## ğŸ¯ Phase 5 ì„±ê³µ ë©”íŠ¸ë¦­ (1-2ì£¼ í›„ í‰ê°€)

| ë©”íŠ¸ë¦­ | ëª©í‘œ | ì¸¡ì • ë°©ë²• | í˜„í™© |
|--------|------|-----------|------|
| ì˜ˆì¸¡ ì •í™•ë„ | RMSE < 0.15 | ì˜ˆì¸¡ vs ì‹¤ì œ ë§Œì¡±ë„ ë¹„êµ | ğŸ• ë°ì´í„° ìˆ˜ì§‘ ì¤‘ |
| 2ì°¨ íŒ¨ìŠ¤ ê°ì†Œìœ¨ | -20% | `second_pass` ì´ë²¤íŠ¸ ë¹ˆë„ | ğŸ• ë² ì´ìŠ¤ë¼ì¸ ìˆ˜ë¦½ ì¤‘ |
| í‰ê·  ë§Œì¡±ë„ í–¥ìƒ | +10% | `quality` í‰ê·  ì¦ê°€ | ğŸ• ë°ì´í„° ìˆ˜ì§‘ ì¤‘ |
| False Positive | < 15% | ì˜ëª»ëœ ì¡°ì • ë¹„ìœ¨ | ğŸ• A/B í…ŒìŠ¤íŠ¸ ëŒ€ê¸° |

**í˜„ì¬ ìƒíƒœ**: í›ˆë ¨ ë°ì´í„° íŒŒì´í”„ë¼ì¸ ê°€ë™ ì¤‘ (fb_samples=0 â†’ ì ì§„ì  ì¦ê°€ ì˜ˆìƒ)

---

## ğŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸

### ê¸°ìˆ ì  í˜ì‹ 

1. **ì˜ˆì¸¡ ê¸°ë°˜ ì¡°ì •**: ì‘ë‹µ ìƒì„± **ì „** ë§Œì¡±ë„ ì˜ˆì¸¡ â†’ ì‚¬ì „ ì¡°ì •
2. **ìê¸° ê°œì„  ë£¨í”„**: ê³¼ê±° ì‹¤íŒ¨ íŒ¨í„´ í•™ìŠµ â†’ ë°˜ë³µ ë°©ì§€
3. **ê°œì¸í™” ê¸°ë°˜**: BQI ì¢Œí‘œë¥¼ í†µí•œ ì‚¬ìš©ì ì„ í˜¸ í•™ìŠµ

### êµ¬í˜„ ìš°ìˆ˜ì„±

- **Backward Compatible**: ê¸°ì¡´ Phase 4ì™€ ë°ì´í„° ì†ŒìŠ¤ í†µí•©
- **Zero Downtime**: Ledger enrichmentê°€ ê¸°ì¡´ ì‹œìŠ¤í…œì— ë¬´ì˜í–¥
- **Fail-Safe**: ë°ì´í„° ì—†ì–´ë„ graceful degradation (ê¸°ë³¸ íœ´ë¦¬ìŠ¤í‹± ì‚¬ìš©)

### ìš´ì˜ ê°€ì¹˜

- **ìë™í™”**: ì¼ì¼ í•™ìŠµ, ëŒ€ì‹œë³´ë“œ í†µí•© â†’ ì¸ê°„ ê°œì… ìµœì†Œí™”
- **ê´€ì¸¡ì„±**: ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ (fb_samples/patterns/rules) ì‹œê°í™”
- **í™•ì¥ì„±**: í–¥í›„ ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ (scikit-learn) ì ìš© ê°€ëŠ¥í•œ êµ¬ì¡°

---

## ğŸ”„ ë‹¤ìŒ ë‹¨ê³„ (ìë™ ë°œìƒ)

### Phase 5a: ë°ì´í„° ìˆ˜ì§‘ (1-2ì£¼)

- [ìë™] Task ì‹¤í–‰ ì‹œë§ˆë‹¤ BQI ì¢Œí‘œ ledgerì— ê¸°ë¡
- [ìë™] ì¼ì¼ í•™ìŠµ (03:00) â†’ fb_samples ì ì§„ì  ì¦ê°€
- [ëª¨ë‹ˆí„°ë§] Dashboardì—ì„œ fb_samples/patterns/rules ì¶”ì 

### Phase 5b: ì„±ê³¼ í‰ê°€ (2ì£¼ í›„)

- [ ] RMSE ê³„ì‚° (ì˜ˆì¸¡ vs ì‹¤ì œ ë§Œì¡±ë„)
- [ ] 2ì°¨ íŒ¨ìŠ¤ ë¹ˆë„ Before/After ë¹„êµ
- [ ] í‰ê·  quality ì ìˆ˜ ì¶”ì„¸ ë¶„ì„
- [ ] ì¡°ì • ê·œì¹™ íš¨ê³¼ ê²€ì¦

### Phase 5c: ê³ ë„í™” (1ê°œì›” í›„)

- [ ] Pipeline í†µí•©: ì‘ë‹µ ìƒì„± ì „ ë§Œì¡±ë„ ì˜ˆì¸¡
- [ ] ì¡°ì • ë¡œì§ êµ¬í˜„: empathy layer, explanation adder
- [ ] A/B í…ŒìŠ¤íŠ¸: ì¡°ì • ìœ ë¬´ ë¹„êµ
- [ ] ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ ì ìš© (scikit-learn LinearRegression)

---

## ğŸ“ ì„¸ì…˜ ìš”ì•½

**ëª©í‘œ**: Phase 5 predictor 0 samples ë¬¸ì œ í•´ê²° ë° ì „ì²´ ì‹œìŠ¤í…œ í†µí•©

**ì„±ê³¼**:

- ğŸ› Critical bug ìˆ˜ì • (indentation)
- ğŸ“Š Training data pipeline êµ¬ì¶• (ledger enrichment)
- ğŸ“ˆ Dashboard í†µí•© (feedback metrics)
- ğŸ§ª Full verification (all tests passed)
- ğŸ“ Documentation cleanup (lint fixes)

**í˜„í™©**: Phase 5 ì‹œìŠ¤í…œ 100% ì™„ì„±, í›ˆë ¨ ë°ì´í„° ìˆ˜ì§‘ ê°€ë™ ì¤‘  
**ë‹¤ìŒ**: ìë™ ë™ì‘ (ì¼ì¼ í•™ìŠµ, ëŒ€ì‹œë³´ë“œ ëª¨ë‹ˆí„°ë§)

---

**Phase 5ëŠ” BQI ì‹œìŠ¤í…œì„ ë‹¨ìˆœí•œ ê²€ìƒ‰ ìµœì í™” ë„êµ¬ì—ì„œ ì‚¬ìš©ì í”¼ë“œë°± ì˜ˆì¸¡/ê°œì¸í™” ì—”ì§„ìœ¼ë¡œ ì§„í™”ì‹œí‚¤ëŠ” í˜ì‹ ì  ë‹¨ê³„ë¥¼ ì™„ì„±í–ˆìŠµë‹ˆë‹¤.** ğŸŠ

ì´ì œ AGIëŠ” ê³¼ê±° ì‹¤íŒ¨ íŒ¨í„´ì„ í•™ìŠµí•˜ê³ , ì‚¬ìš©ì ë§Œì¡±ë„ë¥¼ ì˜ˆì¸¡í•˜ë©°, ë°˜ë³µ ì‹¤ìˆ˜ë¥¼ ìë™ìœ¼ë¡œ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
