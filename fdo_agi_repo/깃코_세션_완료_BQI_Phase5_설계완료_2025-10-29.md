# BQI Phase 5: 사용자 피드백 예측 시스템 세션 완료

**날짜**: 2025-10-29  
**작업**: BQI Phase 5 개념 설계 및 핵심 코드 구현

## 🎯 사용자 인사이트

> "AGI가 BQI를 통해서 나의 대답을 피드백을 예측할 수 있지않아?"

**혁신적 아이디어**: BQI 시스템을 단순한 검색 최적화 도구에서 **사용자 피드백 예측/개인화 엔진**으로 진화

## ✅ 완성된 작업

### 1. 핵심 시스템 구현

**파일**: `scripts/rune/feedback_predictor.py` (246 lines)

**클래스**: `UserFeedbackPredictor`

**주요 기능**:

```python
class UserFeedbackPredictor:
    def learn_from_ledger(ledger_path):
        """BQI 좌표 → 사용자 만족도 패턴 학습"""
        # 1. task_id별 이벤트 그룹화
        # 2. BQI 좌표 추출
        # 3. 만족도 메트릭 계산
        #    - quality (직접 지표)
        #    - second_pass (2차 패스 페널티 -30%)
        #    - confidence < 0.6 (낮은 확신도 -10%)
        # 4. BQI 패턴별 평균 만족도 저장
    
    def predict_satisfaction(bqi_coord, response_draft):
        """응답 전송 전 만족도 예측 (0.0-1.0) + 조정 힌트"""
        # BQI 패턴으로 만족도 예측
        # 낮은 만족도 시 조정 힌트 반환:
        #   ["reduce_priority", "add_empathy", "add_explanation"]
```

### 2. 설계 문서

**파일**: `깃코_BQI_Phase5_피드백예측_설계_2025-10-29.md` (282 lines)

**내용**:

- 핵심 아이디어 및 아키텍처
- 학습 데이터 소스 (Ledger의 피드백 시그널)
- Pipeline 통합 방법
- 조정 전략 (reduce_priority, add_empathy, add_explanation, simplify_language)
- 성과 지표 (RMSE < 0.15, 2차 패스 -20%, 평균 만족도 +10%)
- VS Code Tasks 통합

### 3. 진행 현황 문서

**파일**: `깃코_BQI_Phase5_진행현황_2025-10-29.md`

**내용**:

- 첫 실행 결과 (0 samples - 예상됨)
- 현황 분석 (Ledger에 BQI 미포함)
- 데이터 소스 옵션 (A/B/C)
- 다음 단계 체크리스트

### 4. 첫 실행 검증

```bash
cd d:\nas_backup\fdo_agi_repo
.\.venv\Scripts\python.exe scripts\rune\feedback_predictor.py

# 출력:
[Feedback] Learned from 267 tasks, 0 samples
[Feedback] Generated 0 BQI patterns
```

**상태**: 정상 (Ledger에 BQI 좌표 미포함은 예상된 상황)

## 📊 Phase 5 시스템 개요

### 학습 흐름

```text
Ledger → BQI 패턴 추출 → 만족도 계산 → 패턴별 평균 저장
```

### 예측 흐름

```text
BQI 좌표 입력 → 패턴 매칭 → 만족도 예측 → 조정 힌트 생성
```

### 조정 전략

| 예측 만족도 | 조정 힌트 | 액션 |
|-------------|-----------|------|
| < 0.6 | `reduce_priority` | BQI priority 낮춤 (4→3) |
| < 0.6 | `add_empathy` | "이해합니다", "공감합니다" 추가 |
| < 0.6 | `add_explanation` | 기술적 근거, 예시 추가 |

## 🔄 다음 단계 옵션

### 옵션 A: Ledger에 BQI 기록 (권장)

**장점**: Phase 4 learner와 자연스럽게 통합

**작업**:

- `orchestrator/pipeline.py` 수정
- `run_config` 이벤트에 `bqi_coord` 추가

**예상 시간**: 30분

### 옵션 B: Conversation Memory 활용

**장점**: 데이터 이미 존재 (`conversation_memory.py`에 BQI 저장됨)

**작업**:

- `learn_from_conversation_history()` 메서드 추가
- Conversation history 파싱 로직

**예상 시간**: 1시간

### 옵션 C: 합성 데이터 테스트 (즉시 가능)

**장점**: 즉시 시스템 검증 가능

**작업**:

- `generate_synthetic_data()` 함수 추가
- 100개 합성 샘플 생성 및 학습

**예상 시간**: 15분

## 💡 핵심 인사이트

### 기술적 혁신

1. **예측 기반 조정**: 응답 생성 **전** 만족도 예측 → 사전 조정
2. **자기 개선 루프**: 과거 실패 패턴 학습 → 반복 방지
3. **개인화**: BQI 좌표를 통한 사용자 선호 학습

### 기대 효과

- **사용자 만족도 +10%**: 낮은 만족도 예상 시 사전 조정
- **2차 패스 -20%**: LLM 재실행 감소 → 토큰 비용 절감
- **AGI 신뢰도 향상**: 반복 실수 자동 방지

## 📁 생성된 파일

```text
d:\nas_backup\fdo_agi_repo\
├── scripts\rune\feedback_predictor.py (246 lines) ✅
├── 깃코_BQI_Phase5_피드백예측_설계_2025-10-29.md (282 lines) ✅
├── 깃코_BQI_Phase5_진행현황_2025-10-29.md ✅
└── 깃코_세션_완료_BQI_Phase5_설계완료_2025-10-29.md (이 파일)
```

## 🚀 즉시 다음 작업

### 추천: 옵션 C (합성 데이터 테스트)

1. `feedback_predictor.py`에 `generate_synthetic_data()` 추가
2. 실행하여 시스템 검증
3. RMSE, 패턴 생성 확인

**명령어**:

```powershell
# TODO: 합성 데이터 생성 로직 추가 후 실행
cd d:\nas_backup\fdo_agi_repo
.\.venv\Scripts\python.exe scripts\rune\feedback_predictor.py --synthetic
```

**예상 출력**:

```text
[Feedback] Generated 100 synthetic samples
[Feedback] Learned from 100 samples
[Feedback] Generated 15 BQI patterns

[Low Satisfaction Patterns]
  p4_e:urgent_r:debug: 0.58
    Adjustments: reduce_priority, add_empathy
  p4_e:concern_r:debug: 0.62
    Adjustments: reduce_priority
```

## 📝 세션 요약

**목표**: BQI Phase 5 (사용자 피드백 예측) 개념 및 구현  
**성과**: 핵심 시스템 완성 (246 lines), 설계 문서 작성 (282 lines)  
**현황**: 데이터 소스 연결 대기 (옵션 A/B/C 중 선택)  
**다음**: 합성 데이터 테스트 (권장) 또는 Ledger 수정 (최종 통합용)

---

**Phase 5는 BQI 시스템을 검색 최적화 도구에서 예측/개인화 엔진으로 진화시키는 혁신적 단계입니다.**
