# SYNTHESIS_SECTION_MAX_CHARS 최적화 분석 보고서

**작성자**: 세나 (Sena)
**작성일**: 2025-10-26
**목적**: 깃코의 AGI 성능 최적화 (Phase 6) 지원
**대상**: SYNTHESIS_SECTION_MAX_CHARS 설정 최적값 탐색

---

## 📋 Executive Summary

**결론**: **SYNTHESIS_SECTION_MAX_CHARS=900 유지 권장** ✅

**핵심 근거**:
- Quality: 900이 5% 우수 (0.800 vs 0.760)
- Confidence: 900이 10.3% 우수 (0.648 vs 0.581)
- 안정성: 900이 압도적으로 안정적 (표준편차 거의 0)
- 800으로 줄이면 오히려 **품질 저하** 및 **불안정성 증가**

**다음 단계**: 900 vs 1000 테스트 권장 (더 높은 값 시도)

---

## 🔬 테스트 설계

### 테스트 조건

| 항목 | 값 |
|------|-----|
| **Config A** | SYNTHESIS_SECTION_MAX_CHARS=900 (현재 기본값) |
| **Config B** | SYNTHESIS_SECTION_MAX_CHARS=800 (압축 강화) |
| **반복 횟수** | 각 5회 (총 10회 실행) |
| **작업** | "AGI 자기교정 루프 설명 3문장" |
| **실행 시간** | 2025-10-26 12:01 |
| **소요 시간** | 약 2분 (자동 실행) |

### 측정 메트릭

1. **Quality** (0.0~1.0): 결과물 품질 - **가장 중요**
2. **Confidence** (0.0~1.0): Meta-cognition 자신감
3. **Second Pass Rate**: 자기교정 빈도 (낮을수록 좋음)
4. **Duration**: 실행 시간 (빠를수록 좋음)

---

## 📊 테스트 결과

### 종합 비교

| 메트릭 | Config A (900) | Config B (800) | 차이 | 승자 |
|--------|---------------|----------------|------|------|
| **Quality** | 0.800 ±0.000 | 0.760 ±0.089 | **-0.040 (-5.0%)** | **A** ✅ |
| **Confidence** | 0.648 ±0.004 | 0.581 ±0.180 | **-0.067 (-10.3%)** | **A** ✅ |
| **Second Pass** | 0.000 ±0.000 | 0.067 ±0.149 | +0.067 | **A** ✅ |
| **Duration** | 6.6s ±0.4 | 6.7s ±0.1 | +0.1s (+1.4%) | **A** ✅ |

### 원시 데이터 분석

#### Config A (900) - 완벽한 일관성
```
Quality:     [0.800, 0.800, 0.800, 0.800, 0.800]  ← 5회 모두 동일
Confidence:  [0.644, 0.645, 0.648, 0.650, 0.653]  ← 안정적 상승
Second Pass: [0,     0,     0,     0,     0    ]  ← 재실행 없음
Duration:    [7.1s,  6.3s,  6.9s,  6.3s,  6.5s ]
```

#### Config B (800) - 4번째 실행 이상치 발생
```
Quality:     [0.800, 0.800, 0.800, 0.600, 0.800]  ← 4번째 실패
Confidence:  [0.656, 0.661, 0.663, 0.259, 0.667]  ← 4번째 급락
Second Pass: [0,     0,     0,     0.333, 0   ]  ← 4번째 재실행
Duration:    [6.8s,  6.6s,  6.9s,  6.8s,  6.6s ]
```

**Critical Insight**: Config B의 4번째 실행에서:
- Quality가 0.800 → 0.600으로 급락 (25% 하락)
- Confidence가 0.663 → 0.259로 급락 (61% 하락)
- Second Pass Rate 0.333 발생 (자기교정 필요)
- 이는 **프롬프트 압축이 너무 강해서 정보 손실 발생**을 의미

---

## 🔍 상세 분석

### 1. Quality 분석 ⭐⭐⭐ (최우선)

**Config A (900)**:
- 평균: 0.800
- 표준편차: 0.000 ← **완벽한 재현성**
- 범위: [0.800, 0.800]
- 결론: 항상 고품질 결과 보장

**Config B (800)**:
- 평균: 0.760
- 표준편차: 0.089 ← **불안정**
- 범위: [0.600, 0.800]
- 결론: 때때로 저품질 결과 발생 (리스크)

**판정**: Config A 압도적 승리. 5% 품질 차이는 프로덕션 환경에서 **매우 유의미**.

### 2. Confidence 분석 ⭐⭐

**Config A (900)**:
- 평균: 0.648
- 표준편차: 0.004 ← **매우 안정적**
- 범위: [0.644, 0.653]

**Config B (800)**:
- 평균: 0.581
- 표준편차: 0.180 ← **매우 불안정**
- 범위: [0.259, 0.667]

**판정**: Config A 승리. Confidence가 낮고 불안정하면 시스템이 자신의 능력을 신뢰하지 못함.

### 3. Second Pass Rate 분석 ⭐

**Config A (900)**:
- 5회 모두 0 ← 한 번에 성공

**Config B (800)**:
- 4회는 0, 1회는 0.333 ← 재실행 발생

**판정**: Config A 승리. 재실행은 비효율적이며 시간 낭비.

### 4. Duration 분석

**차이**: 0.1초 (1.4%) ← **무시 가능한 차이**

**판정**: 무승부. 속도는 거의 동일.

---

## 🎯 결론 및 권장사항

### ✅ 최종 결론

**SYNTHESIS_SECTION_MAX_CHARS=900 유지 권장**

**이유**:
1. **Quality 우위**: 5% 높음 + 완벽한 재현성
2. **Confidence 우위**: 10.3% 높음 + 안정적
3. **안정성 우위**: 표준편차 거의 0 (vs 0.089/0.180)
4. **효율성**: Second Pass 불필요 (재실행 없음)
5. **속도**: 거의 동일 (0.1초 차이)

### ❌ Config B (800)를 채택하지 않는 이유

1. **정보 손실**: 프롬프트를 너무 압축하면 중요 정보 손실
2. **불안정성**: 5회 중 1회 실패 (20% 실패율)
3. **품질 저하**: 평균 Quality 5% 하락
4. **리스크**: 예측 불가능한 이상치 발생

### 🚀 다음 단계 권장

**900이 800보다 낫다면, 1000은 어떨까?**

#### 제안: 900 vs 1000 A/B 테스트

**가설**:
- 1000으로 늘리면 더 많은 컨텍스트 보존
- Quality/Confidence 추가 향상 가능
- 속도는 약간 느려질 수 있음 (토큰 증가)

**실행 방법**:
```bash
cd D:\nas_backup\fdo_agi_repo\monitor
python run_ab_test.py --config-a 900 --config-b 1000 --iterations 5
```

**예상 결과**:
- 시나리오 1 (최선): 1000이 Quality/Confidence 향상
- 시나리오 2 (중립): 900과 거의 동일 → 900 유지
- 시나리오 3 (최악): 1000이 오히려 저하 → 900 확정

**소요 시간**: 약 2분 (자동 실행)

#### 추가 탐색 경로

**최적값 범위 좁히기**:
```
900 vs 1000  →  승자 vs 1100  →  ...
```

**Binary Search 방식**:
```
[700, 800, 900, 1000, 1100, 1200] 범위에서 최적값 탐색
```

---

## 📈 프로덕션 적용 가이드

### 즉시 적용 가능

현재 기본값이 900이므로 **변경 불필요**.

만약 800으로 변경했다면:
```bash
# .env 파일 수정
SYNTHESIS_SECTION_MAX_CHARS=900
```

### 모니터링 권장

A/B 테스트 자동화 시스템을 활용하여:
1. **주기적 검증**: 월 1회 900의 성능 검증
2. **자동 알림**: Quality 0.80 미만 시 Slack 알림
3. **대시보드**: http://localhost:5000에서 실시간 모니터링

---

## 📚 참고 자료

- **A/B 테스트 가이드**: `D:\nas_backup\fdo_agi_repo\monitor\AB_TESTING_GUIDE.md`
- **원시 데이터**: `D:\nas_backup\fdo_agi_repo\outputs\ab_test_20251026_120124.json`
- **자동 리포트**: `D:\nas_backup\fdo_agi_repo\outputs\ab_test_20251026_120124_report.md`
- **대시보드**: `http://localhost:5000` (실행 시)

---

## 💡 인사이트

### 프롬프트 압축의 트레이드오프

**발견**:
- 너무 압축 (800) → 정보 손실 → 품질 저하
- 적절한 압축 (900) → 정보 보존 + 효율성
- 압축 없음 (1000+) → 최대 품질? (미검증)

**결론**: 최적값은 "정보 손실 없는 최대 압축"

### 안정성 > 평균 성능

**교훈**:
- Config B의 평균 Quality (0.760)은 나쁘지 않음
- 하지만 **불안정성** (stdev 0.089)이 치명적
- 프로덕션에서는 **예측 가능성**이 더 중요

**적용**: 평균뿐 아니라 표준편차도 함께 고려

---

## 🔄 버전 히스토리

| 날짜 | 테스트 | 결과 | 결정 |
|------|--------|------|------|
| 2025-10-26 | 900 vs 800 | 900 승리 | 900 유지 |
| (미래) | 900 vs 1000 | TBD | TBD |

---

**보고서 종료**

**다음 액션**:
1. ✅ 900 유지 결정을 깃코의 마스터플랜에 반영
2. 🔄 900 vs 1000 A/B 테스트 실행 (옵션)
3. 📊 주기적 모니터링 설정
