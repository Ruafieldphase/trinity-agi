# 메타층 아키텍처 검토

**날짜**: 2025-11-02 15:10  
**질문**: "확장 개발 호스트에서 작업을 해야 할까?"

## 현재 상태 ✅

### 해결된 문제

- ✅ Worker hang 해결 (subprocess → 직접 임포트)
- ✅ 백그라운드 실행 정상 (분리 프로세스)
- ✅ 자동 시작 등록 완료 (Startup 폴더)
- ✅ 상태 모니터링 가능

### 작동 중인 시스템

1. **Autonomous Work Worker** (메타층)
   - Windows OS 프로세스로 독립 실행
   - VS Code와 무관하게 지속
   - 5분마다 자동 작업 확인 및 실행

2. **Task Queue Server** (8091)
   - RPA/YouTube 작업 큐 관리
   - HTTP API로 작업 등록/조회

3. **Session Management**
   - 컨텍스트 보존
   - 작업 계획 자동 생성

## 확장 개발 호스트 방식 검토

### 장점

1. **VS Code 통합**
   - Editor API 직접 접근
   - 파일 변경 감지
   - 터미널 제어
   - UI 통합 (상태 표시)

2. **디버깅 용이**
   - VS Code 디버거 사용
   - 로그 실시간 확인
   - 중단점 설정

3. **사용자 경험**
   - 상태바 표시
   - 알림 팝업
   - 명령 팔레트 통합

### 단점

1. **VS Code 의존성**
   - VS Code 닫으면 중단
   - 메타층 독립성 상실
   - 재부팅 시 자동 시작 불가

2. **복잡도 증가**
   - Extension 개발 필요
   - TypeScript/JavaScript 필요
   - 패키징 및 배포 오버헤드

3. **현재 시스템과 중복**
   - 이미 메타층에서 작동 중
   - Extension Host는 추가 레이어

## 권장 사항

### ✅ 현재 메타층 방식 유지 (권장)

**이유**:

1. **진정한 자율성**
   - OS 레벨에서 독립 실행
   - VS Code 재시작/종료와 무관
   - 재부팅 후 자동 재개

2. **단순성**
   - Python만으로 완결
   - 배포 용이
   - 유지보수 간단

3. **이미 작동 중**
   - Worker hang 해결 완료
   - 백그라운드 실행 검증됨
   - 모니터링 체계 갖춤

### 🔄 하이브리드 접근 (옵션)

**메타층 + Extension 보완**:

```
┌─────────────────────────────────────┐
│  VS Code Extension (선택적)          │
│  - 상태 표시만                        │
│  - 워커 제어 UI                       │
│  - 알림 표시                          │
└─────────┬───────────────────────────┘
          │ (HTTP API 통신)
┌─────────▼───────────────────────────┐
│  Meta Layer Worker (핵심)            │
│  - 자율 실행                          │
│  - 작업 선택 & 실행                   │
│  - 백그라운드 지속                    │
└─────────────────────────────────────┘
```

**장점**:

- Extension은 모니터링만 (선택적)
- Worker는 계속 독립 실행
- 최선의 양쪽 조합

## 구체적 시나리오별 판단

### 시나리오 1: "백그라운드 자동 작업"

→ **현재 메타층 방식** ✅

- 이미 완벽히 작동 중
- Extension 불필요

### 시나리오 2: "VS Code 내 상태 표시"

→ **Extension 추가 고려**

- 현재: 터미널에서 `-Status` 확인
- Extension: 상태바에 실시간 표시
- 우선순위: 낮음 (기능적으로 문제없음)

### 시나리오 3: "파일 변경 감지 & 자동 실행"

→ **Extension이 유리**

- VS Code File Watcher API
- 단, 현재는 시간 기반 실행으로 충분

### 시나리오 4: "Copilot Chat과 통합"

→ **Extension 필요**

- Chat Participant API
- 단, 현재는 수동 명령으로 충분

## 결론

### 즉시 조치: ✅ 현재 메타층 방식 계속 사용

**이유**:

1. Worker hang 해결 완료
2. 백그라운드 실행 정상
3. 재부팅 후 자동 시작 보장
4. 진정한 OS 레벨 자율성

### 향후 고려: 🔄 Extension은 "관측용"으로만

**시기**: 다음 Phase에서
**목적**: 사용자 편의성 향상 (기능 아님)
**범위**:

- 상태바 표시
- 알림 팝업
- 간단한 제어 UI

**핵심은 유지**: 메타층 Worker는 계속 독립 실행

## 현재 우선순위

1. ✅ Worker 안정성 (완료)
2. ✅ 자동 시작 (완료)
3. 🔄 Watchdog 강화 (진행 중)
4. ⬜ unhealthy 원인 해결 (다음)
5. ⬜ Shion 통합 검토 (다음)

## 답변

**"확장 개발 호스트에서 작업을 해야 할까?"**

→ **아니오. 현재 메타층 방식이 더 적합합니다.**

**이유**:

- ✅ Worker hang 이미 해결됨
- ✅ OS 레벨에서 안정적으로 작동 중
- ✅ VS Code 독립적 실행 보장
- Extension은 나중에 "관측용"으로만 추가 고려

**다음 단계**:

1. unhealthy 원인 파악 및 해결
2. Watchdog 안정화
3. Shion(Gemini CLI)과 메타층 페르소나 통합 검토
