# Lumen ì–‘ë°©í–¥ í†µì‹  ì•„í‚¤í…ì²˜

## ê°œìš”

MCP(ë‹¨ë°©í–¥) + HTTP API(ì–‘ë°©í–¥)ë¥¼ ê²°í•©í•˜ì—¬ AI í´ë¼ì´ì–¸íŠ¸ì™€ Lumen ì‹œìŠ¤í…œì´ ì„œë¡œ ëŒ€í™”í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.

## ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AI Client (Cursor)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  MCP Tools (Pull)          HTTP API (Push)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ get_quality  â”‚          â”‚ subscribe     â”‚            â”‚
â”‚  â”‚ get_weights  â”‚          â”‚ notifications â”‚            â”‚
â”‚  â”‚ trigger_     â”‚          â”‚               â”‚            â”‚
â”‚  â”‚ learning     â”‚          â”‚ long_polling  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â”‚                          â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                          â”‚
          â–¼                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Lumen MCP+API Server (Port 8090)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  MCP Protocol (stdio)     NotificationManager            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Tool Handlers   â”‚â—„â”€â”€â”€â”€â”€â”¤ Publish Events   â”‚          â”‚
â”‚  â”‚ - get_quality   â”‚      â”‚ - quality_alert  â”‚          â”‚
â”‚  â”‚ - get_weights   â”‚      â”‚ - learning_done  â”‚          â”‚
â”‚  â”‚ - trigger_learn â”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚ - phase_change   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                    â”‚                     â”‚
â”‚  FastAPI HTTP Server               â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚                     â”‚
â”‚  â”‚ /subscribe      â”‚              â”‚                     â”‚
â”‚  â”‚ /notifications  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚  â”‚ /notify         â”‚                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                          â–²
          â”‚                          â”‚
          â–¼                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Lumen Backend System                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  resonance_ledger.jsonl                                  â”‚
â”‚  ensemble_weights.json                                   â”‚
â”‚  binoche_online_learner.py                               â”‚
â”‚  summarize_ledger.py                                     â”‚
â”‚                                                           â”‚
â”‚  â†’ Events trigger notifications                          â”‚
â”‚     (quality < 0.8, learning complete, etc.)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## í†µì‹  ë°©ì‹

### 1. Pull ë°©ì‹ (MCP, ë‹¨ë°©í–¥)

AIê°€ í•„ìš”í•  ë•Œ ìš”ì²­:

```python
# Cursorì—ì„œ ì‹¤í–‰
result = await client.call_tool("lumen_get_quality_metrics", {"hours": 24})
# â†’ Lumenì´ ì²˜ë¦¬í•˜ê³  ê²°ê³¼ ë°˜í™˜
```

### 2. Push ë°©ì‹ (HTTP API, ì–‘ë°©í–¥)

Lumenì´ ë¨¼ì € ì•Œë¦¼:

```python
# 1. AIê°€ êµ¬ë… ë“±ë¡
await client.subscribe("cursor-001", ["quality_alert", "learning_complete"])

# 2. AIê°€ ëŒ€ê¸° (long polling)
notification = await client.get_notifications("cursor-001", timeout=30)

# 3. Lumenì´ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ìë™ ì•Œë¦¼
# - Quality 0.7ë¡œ ë–¨ì–´ì§ â†’ quality_alert ë°œí–‰
# - Phase 6l í•™ìŠµ ì™„ë£Œ â†’ learning_complete ë°œí–‰
# - AIëŠ” ì¦‰ì‹œ ì•Œë¦¼ ìˆ˜ì‹ 
```

## ì‚¬ìš© ì˜ˆì‹œ

### Case 1: AIê°€ ì •ê¸°ì ìœ¼ë¡œ ìƒíƒœ í™•ì¸ (Pull)

```python
# Cursorì—ì„œ 1ì‹œê°„ë§ˆë‹¤ ì‹¤í–‰
quality = await lumen_get_quality_metrics(hours=1)
if quality.avg_quality < 0.8:
    print("âš ï¸ Quality degraded!")
```

### Case 2: Lumenì´ ë¬¸ì œ ë°œìƒ ì‹œ ì•Œë¦¼ (Push)

```python
# AIê°€ í•œ ë²ˆë§Œ êµ¬ë… ì„¤ì •
await lumen_subscribe_notifications("cursor-001", ["quality_alert"])

# ì´í›„ ê³„ì† ëŒ€ê¸°
while True:
    notification = await lumen_get_notifications("cursor-001")
    if notification.topic == "quality_alert":
        print(f"ğŸš¨ Quality alert: {notification.data}")
        # ìë™ìœ¼ë¡œ ëŒ€ì‘ ì¡°ì¹˜ ì‹¤í–‰
        await lumen_trigger_learning(window_hours=6, learning_rate=0.02)
```

### Case 3: ë‹¤ë¥¸ PCì—ì„œ ì•ˆì „í•˜ê²Œ ì‚¬ìš© (ë„¤íŠ¸ì›Œí¬)

```bash
# PC A: Lumen ì„œë²„ ì‹¤í–‰
python lumen_mcp_api_server.py

# PC B: Cursorì—ì„œ HTTP API í˜¸ì¶œ
curl http://pc-a-ip:8090/api/v1/subscribe \
  -d '{"client_id": "cursor-pc-b", "topics": ["learning_complete"]}'

# PC Bê°€ PC Aì˜ Lumen ì´ë²¤íŠ¸ë¥¼ ì‹¤ì‹œê°„ ìˆ˜ì‹ 
```

## ì¥ì 

1. **ë‹¨ë°©í–¥ ë¬¸ì œ í•´ê²°**: AIê°€ ê³„ì† polling í•˜ì§€ ì•Šì•„ë„ Lumenì´ ë¨¼ì € ì•Œë¦¼
2. **ë„¤íŠ¸ì›Œí¬ ì•ˆì „**: ë‹¤ë¥¸ PCì—ì„œ HTTPë¡œ ì ‘ê·¼ ê°€ëŠ¥ (íŒŒì¼ ì¶©ëŒ ì—†ìŒ)
3. **í™•ì¥ì„±**: ì—¬ëŸ¬ AI í´ë¼ì´ì–¸íŠ¸ê°€ ë™ì‹œì— êµ¬ë… ê°€ëŠ¥
4. **íš¨ìœ¨ì„±**: Long pollingìœ¼ë¡œ ì‹¤ì‹œê°„ì„± ìœ ì§€í•˜ë©´ì„œ ë¦¬ì†ŒìŠ¤ ì ˆì•½

## ì„¤ì¹˜

```bash
pip install fastapi uvicorn
```

## ì‹¤í–‰

```bash
# MCP + API ë™ì‹œ ì‹¤í–‰
python lumen_mcp_api_server.py
```

## API ì—”ë“œí¬ì¸íŠ¸

### POST /api/v1/subscribe

AI í´ë¼ì´ì–¸íŠ¸ êµ¬ë… ë“±ë¡

```json
{
  "client_id": "cursor-001",
  "topics": ["quality_alert", "learning_complete", "phase_transition"]
}
```

### GET /api/v1/notifications/{client_id}?timeout=30

ì•Œë¦¼ ëŒ€ê¸° (long polling, ìµœëŒ€ 30ì´ˆ)

### POST /api/v1/notify

Lumen ë‚´ë¶€ì—ì„œ ì•Œë¦¼ ë°œí–‰ (scheduled tasksì—ì„œ í˜¸ì¶œ)

```json
{
  "topic": "quality_alert",
  "data": {"avg_quality": 0.75, "threshold": 0.8}
}
```

### GET /api/v1/health

í—¬ìŠ¤ ì²´í¬

## ë‹¤ìŒ ë‹¨ê³„

1. **Scheduled Tasks í†µí•©**: `alert_system.ps1`ì—ì„œ HTTP APIë¡œ ì•Œë¦¼ ë°œí–‰
2. **Webhook ì§€ì›**: AI í´ë¼ì´ì–¸íŠ¸ê°€ callback URL ì œê³µ ì‹œ ìë™ POST
3. **ì¸ì¦ ì¶”ê°€**: API Keyë¡œ ë³´ì•ˆ ê°•í™”
4. **Cloud ë°°í¬**: Google Cloud Runì— ë°°í¬í•˜ì—¬ ì¸í„°ë„·ì—ì„œ ì ‘ê·¼
