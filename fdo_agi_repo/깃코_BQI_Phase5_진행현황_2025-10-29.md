# BQI Phase 5: ì‚¬ìš©ì í”¼ë“œë°± ì˜ˆì¸¡ ì‹œìŠ¤í…œ

## âœ… ì™„ë£Œ ì‚¬í•­

### 1. í•µì‹¬ ì‹œìŠ¤í…œ êµ¬í˜„

**íŒŒì¼**: `d:\nas_backup\fdo_agi_repo\scripts\rune\feedback_predictor.py` (246 lines)

**ê¸°ëŠ¥**:

- BQI ì¢Œí‘œ â†’ ì‚¬ìš©ì ë§Œì¡±ë„ íŒ¨í„´ í•™ìŠµ
- ì‘ë‹µ ìƒì„± ì „ ë§Œì¡±ë„ ì˜ˆì¸¡ (0.0-1.0)
- ë‚®ì€ ë§Œì¡±ë„ ì‹œ ì¡°ì • íŒíŠ¸ ì œê³µ

**í•™ìŠµ ë¡œì§**:

```python
satisfaction = quality
if had_second_pass:
    satisfaction *= 0.7  # 2ì°¨ íŒ¨ìŠ¤ í˜ë„í‹°
if confidence < 0.6:
    satisfaction *= 0.9  # ë‚®ì€ í™•ì‹ ë„ í˜ë„í‹°
```

### 2. ì²« ì‹¤í–‰ ê²°ê³¼

```text
[Feedback] Learned from 267 tasks, 0 samples
[Feedback] Generated 0 BQI patterns
```

**ì˜ˆìƒ ê²°ê³¼**: í˜„ì¬ Ledgerì— BQI ì¢Œí‘œê°€ ê¸°ë¡ë˜ì§€ ì•ŠìŒ (ì„¤ê³„ìƒ ì •ìƒ)

## ğŸ” í˜„í™© ë¶„ì„

### Ledger êµ¬ì¡° í™•ì¸

í˜„ì¬ `resonance_ledger.jsonl`ì—ëŠ” BQI ì¢Œí‘œê°€ **í¬í•¨ë˜ì§€ ì•ŠìŒ**:

```json
{"event": "meta_cognition", "confidence": 0.644, ...}
{"event": "eval", "quality": 0.8, ...}
{"event": "second_pass", "task_id": "..."}
```

### BQI ì¢Œí‘œ ì¡´ì¬ ìœ„ì¹˜

1. **conversation_memory** (`orchestrator/conversation_memory.py`):
   - `ConversationTurn.bqi_coord` (Dict)
   - Conversation historyì— ì €ì¥ë¨

2. **BQI Training Data** (`scripts/generate_bqi_training_data.py`):
   - ìƒì„±ëœ í›ˆë ¨ ë°ì´í„°ì— í¬í•¨

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

### Phase 5a: ë°ì´í„° ì†ŒìŠ¤ ì—°ê²° (ì„ íƒì§€)

#### ì˜µì…˜ A: Ledgerì— BQI ê¸°ë¡ ì¶”ê°€ (ê¶Œì¥)

**ì¥ì **: Phase 4 learnerì™€ í†µí•© ìš©ì´

**êµ¬í˜„**:

```python
# orchestrator/pipeline.py ìˆ˜ì •
def run(...):
    # BQI ì¢Œí‘œ ìƒì„±
    self.bqi_coord = analyse_question(self.goal)
    
    # Ledgerì— ê¸°ë¡
    ledger.add({
        "event": "run_config",
        "task_id": self.task_id,
        "bqi_coord": self.bqi_coord.to_dict(),
        ...
    })
```

#### ì˜µì…˜ B: Conversation Memoryì—ì„œ í•™ìŠµ

**ì¥ì **: ì¦‰ì‹œ êµ¬í˜„ ê°€ëŠ¥ (ë°ì´í„° ì´ë¯¸ ì¡´ì¬)

**êµ¬í˜„**:

```python
# feedback_predictor.py ìˆ˜ì •
def learn_from_conversation_history(
    self,
    history_path: str = "orchestrator/conversation_history.json"
):
    """Conversation historyì—ì„œ BQIâ†’ë§Œì¡±ë„ í•™ìŠµ"""
    with open(history_path, 'r', encoding='utf-8') as f:
        conversations = json.load(f)
    
    for conv in conversations:
        for turn in conv["turns"]:
            bqi_coord = turn.get("bqi_coord")
            # quality ì¶”ì • (ì‘ë‹µ ê¸¸ì´, í›„ì† ì§ˆë¬¸ ìœ ë¬´ ë“±)
            satisfaction = self._estimate_satisfaction(turn)
            ...
```

#### ì˜µì…˜ C: í•©ì„± ë°ì´í„° ìƒì„± (í…ŒìŠ¤íŠ¸ìš©)

**ì¥ì **: ì¦‰ì‹œ ê²€ì¦ ê°€ëŠ¥

**êµ¬í˜„**:

```python
# scripts/rune/feedback_predictor.pyì— ì¶”ê°€
def generate_synthetic_data(count=100):
    """í…ŒìŠ¤íŠ¸ìš© í•©ì„± ë°ì´í„° ìƒì„±"""
    import random
    
    patterns = []
    for _ in range(count):
        priority = random.randint(1, 4)
        emotion = random.choice([
            ["urgent"], ["concern"], ["curiosity"], 
            ["urgent", "concern"], []
        ])
        rhythm = random.choice(["debug", "reflection", "exploration"])
        
        # íœ´ë¦¬ìŠ¤í‹±: priority ë†’ì„ìˆ˜ë¡ ë§Œì¡±ë„ ë‚®ìŒ
        satisfaction = 0.9 - (priority - 1) * 0.1
        satisfaction += random.gauss(0, 0.1)  # ë…¸ì´ì¦ˆ
        satisfaction = max(0.0, min(1.0, satisfaction))
        
        patterns.append({
            "bqi": {"priority": priority, "emotion": emotion, "rhythm": rhythm},
            "satisfaction": satisfaction
        })
    
    return patterns
```

### Phase 5b: í†µí•© í…ŒìŠ¤íŠ¸

1. í•©ì„± ë°ì´í„°ë¡œ í•™ìŠµ
2. ì˜ˆì¸¡ ì •í™•ë„ ê²€ì¦ (RMSE < 0.15)
3. ì¡°ì • íŒíŠ¸ ê²€ì¦

### Phase 5c: Pipeline í†µí•©

1. `Pipeline.run()` ìˆ˜ì •
2. ì‘ë‹µ ìƒì„± ì „ ë§Œì¡±ë„ ì˜ˆì¸¡
3. ë‚®ì€ ë§Œì¡±ë„ ì‹œ ì¡°ì • ë¡œì§ ì¶”ê°€

## ğŸ“‹ ì‘ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] `UserFeedbackPredictor` í´ë˜ìŠ¤ êµ¬í˜„
- [x] Ledger êµ¬ì¡° ë¶„ì„ ì™„ë£Œ
- [ ] **ì„ íƒ**: ë°ì´í„° ì†ŒìŠ¤ ê²°ì • (A/B/C)
- [ ] í•™ìŠµ ë°ì´í„° ì¤€ë¹„
- [ ] ëª¨ë¸ í•™ìŠµ ë° ê²€ì¦
- [ ] Pipeline í†µí•©
- [ ] A/B í…ŒìŠ¤íŠ¸

## ğŸš€ ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ë‹¤ìŒ ì‘ì—…

### ì¶”ì²œ: ì˜µì…˜ C (í•©ì„± ë°ì´í„° í…ŒìŠ¤íŠ¸)

```powershell
# 1. feedback_predictor.pyì— í•©ì„± ë°ì´í„° ìƒì„± ì¶”ê°€
# 2. ì‹¤í–‰
cd d:\nas_backup\fdo_agi_repo
.\.venv\Scripts\python.exe -c "
from scripts.rune.feedback_predictor import UserFeedbackPredictor
predictor = UserFeedbackPredictor()
# TODO: í•©ì„± ë°ì´í„° ìƒì„± ë° í•™ìŠµ
"
```

**ì˜ˆìƒ ì¶œë ¥**:

```text
[Feedback] Generated 100 synthetic samples
[Feedback] Learned from 100 samples
[Feedback] Generated 15 BQI patterns
[Low Satisfaction Patterns]
  p4_e:urgent_r:debug: 0.58
    Adjustments: reduce_priority, add_empathy
```

## ğŸ’¡ ê²°ë¡ 

**Phase 5 í•µì‹¬ ì‹œìŠ¤í…œì€ ì™„ì„±**ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ëŠ”:

1. **ë°ì´í„° ì†ŒìŠ¤ ì„ íƒ** (ì˜µì…˜ Aê¶Œì¥, Cë¡œ ì¦‰ì‹œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥)
2. **í•™ìŠµ ë° ê²€ì¦**
3. **Pipeline í†µí•©**

ì‚¬ìš©ì ì˜ê²¬: ì–´ë–¤ ì˜µì…˜ìœ¼ë¡œ ì§„í–‰í• ê¹Œìš”?

- A: Ledgerì— BQI ê¸°ë¡ ì¶”ê°€ (ì œì¼ ê¹”ë”, í•˜ì§€ë§Œ Pipeline ìˆ˜ì • í•„ìš”)
- B: Conversation Memory í™œìš© (ë°ì´í„° ì¡´ì¬, history íŒŒì‹± í•„ìš”)
- C: í•©ì„± ë°ì´í„° í…ŒìŠ¤íŠ¸ (ì¦‰ì‹œ ê²€ì¦ ê°€ëŠ¥, í”„ë¡œí† íƒ€ì…ìš©)
